"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[105],{7258:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"keys-store","title":"Keys Store","description":"The Expo Open OTA server requires several keys and secrets to interact with the Expo API and your CDN.","source":"@site/docs/keys-store.mdx","sourceDirName":".","slug":"/keys-store","permalink":"/expo-open-ota/docs/keys-store","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/keys-store.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docSidebar","previous":{"title":"Prerequisites","permalink":"/expo-open-ota/docs/prerequisites"},"next":{"title":"CDN","permalink":"/expo-open-ota/docs/cdn"}}');var o=r(4848),t=r(8453);const i={sidebar_position:5},a="Keys Store",l={},c=[{value:"Keys",id:"keys",level:2},{value:"Expo signing certificate",id:"expo-signing-certificate",level:2},{value:"Cloudfront private key",id:"cloudfront-private-key",level:2},{value:"Key Store Configuration",id:"key-store-configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"AWS Secrets Manager",id:"aws-secrets-manager",level:3},{value:"Local Key Store",id:"local-key-store",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"keys-store",children:"Keys Store"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.strong,{children:"Expo Open OTA"})," server requires several keys and secrets to interact with the Expo API and your CDN."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.strong,{children:"Key store"})," is a module that manages how these keys are accessed by the server."]}),"\n",(0,o.jsx)(n.p,{children:"You can use 3 different key stores:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Local Key Store"}),": Keys are stored in a directory on the server as *.pem files."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"AWS Secrets Manager"}),": Keys are stored in AWS Secrets Manager and securely accessed by the server."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Environment Variables"}),": Keys are stored as environment variables in base64 format."]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["The environment variables required for key store configuration are listed below. You can set them in a ",(0,o.jsx)(n.code,{children:".env"})," file in the root of the project or keep them in a safe place to prepare for deployment."]})}),"\n",(0,o.jsx)(n.h2,{id:"keys",children:"Keys"}),"\n",(0,o.jsx)(n.p,{children:"The following keys are used by the server:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Expo signing key pairs"}),": Used to sign and verify the updates returned by the server to ",(0,o.jsx)(n.code,{children:"expo-updates"}),". The key pair consists of a public and private key and are ",(0,o.jsx)(n.strong,{children:"required"})," by the server."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Cloudfront private key"}),": Used to sign the Cloudfront URLs for the assets. This key is ",(0,o.jsx)(n.strong,{children:"optional"})," and only required if you are using Cloudfront as your CDN."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"expo-signing-certificate",children:"Expo signing certificate"}),"\n",(0,o.jsx)(n.p,{children:"To generate expo signing key pairs :"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"On your terminal, go to the root directory of your expo project."}),"\n",(0,o.jsx)(n.li,{children:"Run the following command:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"npx eoas generate-certs\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Three files will be generated in the ",(0,o.jsx)(n.code,{children:"certs"})," directory:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"private-key.pem"}),": The private key used to sign the updates."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"public-key.pem"}),": The public key used to verify the updates.\nThose two keys are used by the server to sign and verify the updates."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"certificate.pem"}),": Used by your expo client to verify the updates. It should be committed to your expo project."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"cloudfront-private-key",children:"Cloudfront private key"}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"This key is only required if you are using Cloudfront as your CDN."})}),"\n",(0,o.jsxs)(n.p,{children:["Please refer to this ",(0,o.jsx)(n.a,{href:"/docs/cdn#cloudfront",children:"section"})," on how to generate a Cloudfront private key."]}),"\n",(0,o.jsx)(n.h2,{id:"key-store-configuration",children:"Key Store Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,o.jsx)(n.p,{children:"You will have to encode the keys in base64 format and set the following environment variables:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'echo -n "your-private-key" | base64\n'})}),"\n",(0,o.jsx)(n.p,{children:"Then set the following environment variables:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"KEYS_STORAGE_TYPE=environment\nPUBLIC_EXPO_KEY_B64=base64-encoded-public-key\nPRIVATE_EXPO_KEY_B64=base64-encoded-private-key\nPRIVATE_CLOUDFRONT_KEY_B64=base64-encoded-cloudfront-private-key\n"})}),"\n",(0,o.jsx)(n.h3,{id:"aws-secrets-manager",children:"AWS Secrets Manager"}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["If you are not familiar with AWS Secrets Manager, you can refer to the ",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html",children:"official documentation"}),"."]})}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Create a secret for each keys in AWS Secrets Manager."}),"\n",(0,o.jsx)(n.li,{children:"Set the following environment variables:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"KEYS_STORAGE_TYPE=aws-secrets-manager\nAWS_KEYS_PRIVATE_EXPO_KEY_SECRET_ID=The secret name of the expo private key\nAWS_KEYS_PUBLIC_EXPO_KEY_SECRET_ID=The secret name of the expo public key\nAWS_KEYS_PRIVATE_CLOUDFRONT_KEY_SECRET_ID=The secret name of the cloudfront private key\nAWS_REGION=your-region\n"})}),"\n",(0,o.jsx)(n.p,{children:"If your are not using AWS IAM roles, you also need to set the following environment variables:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"AWS_ACCESS_KEY_ID=your-access-key-id\nAWS_SECRET_ACCESS_KEY=your-secret-access-key\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["The server use the same AWS credentials for ",(0,o.jsx)(n.a,{href:"/docs/storage#amazon-s3",children:"S3 Storage"})," and AWS Secrets Manager. Please ensure to setup the correct ACLs and permissions for the keys."]})}),"\n",(0,o.jsx)(n.h3,{id:"local-key-store",children:"Local Key Store"}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:"This key store is not recommended for production use. It is intended for development and testing purposes only."})}),"\n",(0,o.jsx)(n.p,{children:"To use local key store you will need to set the following environment variables:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"KEYS_STORAGE_TYPE=local\nPUBLIC_LOCAL_EXPO_KEY_PATH=/path/to/public-key.pem\nPRIVATE_LOCAL_EXPO_KEY_PATH=/path/to/private-key.pem\nPRIVATE_LOCAL_CLOUDFRONT_KEY_PATH=/path/to/cloudfront-private-key.pem\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>a});var s=r(6540);const o={},t=s.createContext(o);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);